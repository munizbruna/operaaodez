<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operação Dezembro - Treino e Timer</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Animações simples para transição de telas */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Estilo para garantir que o modal fique no topo */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.9);
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans text-slate-800 pb-20 select-none">

    <!-- Container Principal da Aplicação -->
    <div id="app">
        <!-- O conteúdo será injetado aqui via JavaScript -->
    </div>

    <!-- Modal do Timer (Oculto por padrão) -->
    <div id="timer-modal" class="fixed inset-0 modal-overlay z-50 hidden flex flex-col items-center justify-center p-4 fade-in">
        <div class="w-full max-w-md bg-slate-900 border border-slate-700 text-white rounded-xl shadow-2xl relative overflow-hidden">
            
            <!-- Botão de Mute -->
            <button id="btn-mute" class="absolute top-4 right-4 p-2 text-slate-400 hover:text-white rounded-full bg-slate-800 transition-colors">
                <i data-lucide="volume-2" id="icon-volume"></i>
            </button>

            <div class="p-6 text-center">
                <h3 id="modal-title" class="text-lg font-bold text-emerald-400 mb-2">Título do Exercício</h3>
                
                <!-- Lista de itens do exercício -->
                <div id="modal-items" class="space-y-2 mb-6 text-sm text-slate-300">
                    <!-- Injetado via JS -->
                </div>

                <!-- Display do Tempo -->
                <div id="timer-display" class="text-6xl font-mono font-bold mb-8 tabular-nums text-white">
                    0:00
                </div>

                <!-- Botões de Controle -->
                <div class="grid grid-cols-2 gap-4">
                    <button id="btn-toggle-timer" class="flex items-center justify-center gap-2 p-4 rounded-lg font-bold text-lg transition-all bg-emerald-500 hover:bg-emerald-600">
                        <i data-lucide="play"></i> <span id="lbl-toggle">Iniciar</span>
                    </button>

                    <button id="btn-reset-timer" class="flex items-center justify-center gap-2 p-4 bg-slate-700 hover:bg-slate-600 rounded-lg font-bold text-lg">
                        <i data-lucide="rotate-ccw"></i> Resetar
                    </button>
                </div>

                <!-- Troca de Modo (Execução <-> Descanso) -->
                <div class="mt-6 flex gap-2 justify-center">
                    <button id="btn-switch-mode" class="w-full py-3 rounded-lg font-bold text-white flex items-center justify-center gap-2 transition-colors">
                        <!-- Conteúdo injetado via JS -->
                    </button>
                </div>

                <button id="btn-close-modal" class="mt-8 text-slate-400 hover:text-white underline text-sm w-full py-2">
                    Fechar / Voltar para Lista
                </button>
            </div>
        </div>
    </div>

    <!-- Script da Aplicação -->
    <script>
        // --- DADOS ---
        const WORKOUT_PLAN = {
            A: {
                title: "Treino A: Inferior (Foco Quadríceps)",
                description: "Alta intensidade, pouco descanso.",
                exercises: [
                    {
                        id: 'a1', type: 'biset', title: 'Bi-Set: Pressão e Panturrilha',
                        items: [
                            { name: 'Leg Press 45º', details: '4x 12 reps (Carga Alta ~80kg+)' },
                            { name: 'Panturrilha no Leg', details: '4x 15 reps (Sem descanso após Leg)' }
                        ], restTime: 45
                    },
                    {
                        id: 'a2', type: 'single', title: 'Agachamento (Livre/Smith)',
                        items: [
                            { name: 'Agachamento', details: '3x 12 reps (Descida lenta: 3s)' }
                        ], restTime: 60
                    },
                    {
                        id: 'a3', type: 'single', title: 'Cadeira Extensora',
                        items: [
                            { name: 'Cadeira Extensora', details: '3x 15 reps (Última série: Drop-set até a falha)' }
                        ], restTime: 45
                    },
                    {
                        id: 'a4', type: 'single', title: 'Cadeira Adutora',
                        items: [
                            { name: 'Cadeira Adutora', details: '3x 20 reps (Espremer no meio)' }
                        ], restTime: 45
                    }
                ]
            },
            B: {
                title: "Treino B: Superior + Core",
                description: "Manutenção de massa e postura.",
                exercises: [
                    {
                        id: 'b1', type: 'biset', title: 'Bi-Set: Dorsal e Peito',
                        items: [
                            { name: 'Puxada Frontal', details: '3x 12 reps' },
                            { name: 'Flexão de Braços', details: '3x Máximo possível' }
                        ], restTime: 50
                    },
                    {
                        id: 'b2', type: 'biset', title: 'Bi-Set: Remada e Tríceps',
                        items: [
                            { name: 'Remada Baixa', details: '3x 12 a 15 reps' },
                            { name: 'Tríceps Pulley (Corda)', details: '3x 12 a 15 reps' }
                        ], restTime: 50
                    },
                    {
                        id: 'b3', type: 'biset', title: 'Bi-Set: Ombros',
                        items: [
                            { name: 'Desenvolvimento Halteres', details: '3x 10 reps' },
                            { name: 'Elevação Lateral', details: '3x 12 reps' }
                        ], restTime: 45
                    },
                    {
                        id: 'b4', type: 'biset', title: 'Bi-Set: Abdômen',
                        items: [
                            { name: 'Prancha Abdominal', details: '3x 40 segundos (Use o Timer!)' },
                            { name: 'Abdominal Supra', details: '3x 20 reps' }
                        ], restTime: 45
                    }
                ]
            },
            C: {
                title: "Treino C: Posterior e Glúteo",
                description: "Foco na cadeia posterior.",
                exercises: [
                    {
                        id: 'c1', type: 'biset', title: 'Bi-Set: Pré-Exaustão',
                        items: [
                            { name: 'Mesa Flexora', details: '4x 12 reps' },
                            { name: 'Cadeira Abdutora', details: '4x 20 reps (Tronco inclinado)' }
                        ], restTime: 45
                    },
                    {
                        id: 'c2', type: 'single', title: 'Stiff',
                        items: [
                            { name: 'Stiff (Barra/Halteres)', details: '3x 12 reps (Foco no alongamento)' }
                        ], restTime: 60
                    },
                    {
                        id: 'c3', type: 'single', title: 'Elevação Pélvica',
                        items: [
                            { name: 'Elevação Pélvica', details: '3x 10 reps (Segura 2s em cima)' }
                        ], restTime: 60
                    },
                    {
                        id: 'c4', type: 'single', title: 'Cadeira Flexora',
                        items: [
                            { name: 'Cadeira Flexora', details: '3x 15 reps' }
                        ], restTime: 45
                    }
                ]
            }
        };

        const RUNNING_PROTOCOL = [
            { week: 'Semana 1', dates: '23/11 - 30/11', action: '2 min Corre / 1 min Anda (Total 15 min)' },
            { week: 'Semana 2', dates: '01/12 - 07/12', action: '3 min Corre / 1 min Anda (Total 20 min)' },
            { week: 'Semana 3', dates: '08/12 - 14/12', action: '5 min Corre / 2 min Anda (Total 25 min)' },
            { week: 'Semana 4', dates: '15/12 - 21/12', action: '10 a 15 min Contínuos (Teste)' },
        ];

        // --- ESTADO GLOBAL ---
        let currentView = 'home';
        let timerInterval = null;
        let timerTime = 0;
        let timerMode = 'workout'; // 'workout' or 'rest'
        let timerActive = false;
        let currentExercise = null;
        let isMuted = false;

        // --- ELEMENTOS DO DOM ---
        const appDiv = document.getElementById('app');
        const modal = document.getElementById('timer-modal');
        const timerDisplay = document.getElementById('timer-display');
        const btnToggle = document.getElementById('btn-toggle-timer');
        const btnReset = document.getElementById('btn-reset-timer');
        const btnSwitch = document.getElementById('btn-switch-mode');
        const btnClose = document.getElementById('btn-close-modal');
        const btnMute = document.getElementById('btn-mute');
        const iconVolume = document.getElementById('icon-volume');

        // --- INICIALIZAÇÃO ---
        function init() {
            renderHome();
        }

        // --- SOM E VOZ ---
        function playBeep(type = 'end') {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);

            if (type === 'end') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(880, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(440, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.5, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                osc.start();
                osc.stop(ctx.currentTime + 0.5);
            } else {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(600, ctx.currentTime);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                osc.start();
                osc.stop(ctx.currentTime + 0.1);
            }
        }

        function speakExercise(exercise) {
            if (!('speechSynthesis' in window) || isMuted) return;
            
            const speechText = exercise.items.map(item => {
                let details = item.details
                    .replace(/(\d+)x/gi, '$1 séries de')
                    .replace(/reps/gi, 'repetições')
                    .replace(/\//g, ' ou ')
                    .replace(/~/g, 'aproximadamente ')
                    .replace(/\+/g, 'mais ');
                return `${item.name}. ${details}`;
            }).join('. E na sequência: ');

            const fullText = `Iniciando ${exercise.title}. ${speechText}`;
            const utterance = new SpeechSynthesisUtterance(fullText);
            utterance.lang = 'pt-BR';
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utterance);
        }

        // --- RENDERIZAÇÃO DE TELAS ---

        function renderHome() {
            const today = new Date().getDay();
            const weekDays = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
            
            const schedule = {
                1: { type: 'workout', key: 'A', title: 'Treino A' },
                2: { type: 'workout', key: 'B', title: 'Treino B' },
                3: { type: 'workout', key: 'C', title: 'Treino C' },
                4: { type: 'workout', key: 'B', title: 'Treino B' },
                5: { type: 'workout', key: 'A', title: 'Treino A (ou C)' },
                6: { type: 'cardio', title: 'Cardio ao Ar Livre' },
                0: { type: 'rest', title: 'Descanso Total' }
            };

            const suggestion = { dayName: weekDays[today], ...schedule[today] };

            let highlightHtml = '';
            
            if (suggestion.type === 'workout') {
                highlightHtml = `
                    <p class="text-slate-300 text-sm mb-4">Hoje é dia de focar no ${suggestion.title}. Prepare sua água.</p>
                    <button onclick="renderWorkout('${suggestion.key}')" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white py-3 rounded-lg font-bold flex items-center justify-center gap-2 transition-all shadow-lg shadow-emerald-500/20">
                        <i data-lucide="zap"></i> Iniciar ${suggestion.title} Agora
                    </button>
                `;
            } else if (suggestion.type === 'cardio') {
                highlightHtml = `
                    <p class="text-slate-300 text-sm mb-4">Hoje o foco é gastar energia. Trote ou caminhada acelerada ao ar livre.</p>
                    <div class="bg-white/10 p-3 rounded-lg text-sm text-emerald-200"><span class="font-bold">Meta:</span> 40-50 min de atividade moderada.</div>
                `;
            } else {
                highlightHtml = `<p class="text-slate-300 text-sm mb-4">O descanso também é treino. Alimente-se bem e hidrate-se.</p>`;
            }

            const workoutsHtml = Object.keys(WORKOUT_PLAN).map(key => `
                <button onclick="renderWorkout('${key}')" class="w-full bg-white p-5 rounded-xl shadow-sm border border-slate-200 hover:border-emerald-400 transition-all text-left group">
                    <div class="flex justify-between items-center mb-1">
                        <span class="font-bold text-2xl text-emerald-500">${key}</span>
                        <div class="bg-slate-100 p-2 rounded-full group-hover:bg-emerald-50 transition-colors">
                            <i data-lucide="arrow-right" class="text-slate-400 group-hover:text-emerald-500"></i>
                        </div>
                    </div>
                    <h3 class="font-bold text-lg text-slate-800">${WORKOUT_PLAN[key].title}</h3>
                    <p class="text-sm text-slate-500">${WORKOUT_PLAN[key].description}</p>
                </button>
            `).join('');

            const runningHtml = RUNNING_PROTOCOL.map(item => `
                <div class="p-4 text-sm border-b border-slate-100 last:border-0">
                    <div class="flex justify-between font-bold text-slate-700 mb-1">
                        <span>${item.week}</span>
                        <span class="text-xs font-normal text-slate-400 bg-slate-100 px-2 py-0.5 rounded-full">${item.dates}</span>
                    </div>
                    <p class="text-slate-600">${item.action}</p>
                </div>
            `).join('');

            appDiv.innerHTML = `
                <div class="bg-slate-900 text-white p-4 sticky top-0 z-10 shadow-lg mb-4">
                    <h1 class="text-xl font-bold text-emerald-400 uppercase tracking-wider">Operação Dezembro</h1>
                    <p class="text-xs text-slate-400">Meta: 70kg | Corrida 5km</p>
                </div>

                <div class="p-4 space-y-6 fade-in">
                    <!-- Bloco de Destaque -->
                    <div class="bg-gradient-to-r from-slate-900 to-slate-800 p-6 rounded-2xl text-white shadow-xl border-l-4 border-emerald-500 relative overflow-hidden">
                        <div class="relative z-10">
                            <div class="flex items-center gap-2 text-emerald-400 mb-1 font-bold uppercase tracking-wider text-xs">
                                <i data-lucide="calendar" width="14"></i> <span>Hoje é ${suggestion.dayName}</span>
                            </div>
                            <h2 class="text-2xl font-bold mb-2 text-white">
                                ${suggestion.type === 'rest' ? 'Recuperação Muscular' : suggestion.type === 'cardio' ? 'Dia de Cardio' : 'Hora do Treino!'}
                            </h2>
                            ${highlightHtml}
                        </div>
                        <i data-lucide="timer" class="absolute -right-6 -bottom-6 text-white/5 w-40 h-40" width="160" height="160"></i>
                    </div>

                    <div class="space-y-4">
                        <h2 class="font-bold text-xl text-slate-800 flex items-center gap-2"><i data-lucide="dumbbell"></i> Todos os Treinos</h2>
                        ${workoutsHtml}
                    </div>

                    <div class="space-y-4">
                        <h2 class="font-bold text-xl text-slate-800 mt-6 flex items-center gap-2"><i data-lucide="flame"></i> Protocolo de Corrida</h2>
                        <div class="bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden">
                            ${runningHtml}
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
            window.scrollTo(0, 0);
        }

        function renderWorkout(key) {
            const plan = WORKOUT_PLAN[key];
            const exercisesHtml = plan.exercises.map((exercise, index) => {
                const itemsHtml = exercise.items.map(item => `
                    <div class="flex flex-col">
                        <span class="font-bold text-slate-800 text-lg">${item.name}</span>
                        <span class="text-sm text-slate-500">${item.details}</span>
                    </div>
                `).join('');

                const badgeClass = exercise.type === 'biset' ? 'bg-amber-100 text-amber-700' : 'bg-blue-100 text-blue-700';
                const badgeText = exercise.type === 'biset' ? 'Bi-Set (Sem descanso entre eles)' : 'Série Normal';

                // Usamos JSON.stringify no onclick, mas escapamos aspas simples
                const safeExercise = JSON.stringify(exercise).replace(/"/g, '&quot;');

                return `
                <div class="bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden relative group p-5">
                    <div class="absolute top-0 left-0 w-1 h-full bg-emerald-500"></div>
                    
                    <div class="flex justify-between items-start mb-3">
                        <span class="text-xs font-bold px-2 py-1 rounded uppercase tracking-wide ${badgeClass}">${badgeText}</span>
                        <span class="flex items-center text-xs text-slate-500 gap-1 bg-slate-100 px-2 py-1 rounded-full">
                            <i data-lucide="timer" width="12"></i> Descanso: ${exercise.restTime}s
                        </span>
                    </div>

                    <div class="space-y-3 mb-4">
                        ${itemsHtml}
                    </div>

                    <button onclick="openModal(${safeExercise})" class="w-full bg-slate-900 text-white py-3 rounded-lg font-bold flex items-center justify-center gap-2 hover:bg-emerald-600 transition-colors shadow-lg shadow-emerald-900/10">
                        <i data-lucide="play" width="18"></i> Iniciar Exercício
                    </button>
                </div>`;
            }).join('');

            appDiv.innerHTML = `
                <div class="bg-slate-900 text-white p-4 sticky top-0 z-10 shadow-lg">
                    <div class="flex items-center gap-3">
                        <button onclick="renderHome()" class="p-2 hover:bg-slate-800 rounded-full transition-colors">
                            <i data-lucide="arrow-left"></i>
                        </button>
                        <div>
                            <h1 class="text-xl font-bold text-emerald-400 uppercase tracking-wider">${plan.title.split(':')[0]}</h1>
                            <p class="text-xs text-slate-400">${plan.title.split(':')[1] || ''}</p>
                        </div>
                    </div>
                </div>

                <div class="p-4 space-y-4 fade-in">
                    ${exercisesHtml}
                    
                    <div class="mt-8 p-4 bg-emerald-50 rounded-xl border border-emerald-200">
                        <h3 class="font-bold text-emerald-800 mb-2 flex items-center gap-2">
                            <i data-lucide="check-circle" width="20"></i> Pós-Treino: Corrida
                        </h3>
                        <p class="text-sm text-emerald-700 mb-2">Verifique o protocolo da semana na página inicial. Velocidade de trote 8.5 a 9.5km/h.</p>
                    </div>
                </div>
            `;
            lucide.createIcons();
            window.scrollTo(0, 0);
        }

        // --- TIMER LOGIC ---

        function openModal(exercise) {
            currentExercise = exercise;
            
            // Popula Modal
            document.getElementById('modal-title').innerText = exercise.title;
            const itemsContainer = document.getElementById('modal-items');
            itemsContainer.innerHTML = exercise.items.map(item => `
                <div class="flex justify-between border-b border-slate-700 pb-1">
                    <span>${item.name}</span>
                    <span class="text-emerald-200 font-mono text-xs">${item.details.split('(')[0]}</span>
                </div>
            `).join('');

            // Reset Estado
            timerMode = 'workout';
            timerTime = 0;
            timerActive = false;
            updateTimerDisplay();
            updateControlButtons();
            
            modal.classList.remove('hidden');
            
            // Fala
            speakExercise(exercise);
        }

        function closeModal() {
            modal.classList.add('hidden');
            stopTimer();
            window.speechSynthesis.cancel();
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function updateTimerDisplay() {
            timerDisplay.innerText = formatTime(timerTime);
            if (timerMode === 'rest') {
                timerDisplay.classList.remove('text-white');
                timerDisplay.classList.add('text-amber-400');
            } else {
                timerDisplay.classList.add('text-white');
                timerDisplay.classList.remove('text-amber-400');
            }
        }

        function startTimer() {
            if (timerActive) return;
            timerActive = true;
            updateControlButtons();
            
            timerInterval = setInterval(() => {
                if (timerMode === 'rest') {
                    if (timerTime <= 0) {
                        playBeep('end');
                        stopTimer();
                        return; // Fim do descanso
                    }
                    timerTime--;
                } else {
                    timerTime++;
                }
                updateTimerDisplay();
            }, 1000);
        }

        function stopTimer() {
            timerActive = false;
            clearInterval(timerInterval);
            updateControlButtons();
        }

        function toggleTimer() {
            if (timerActive) stopTimer();
            else startTimer();
        }

        function resetTimer() {
            stopTimer();
            timerTime = timerMode === 'rest' ? currentExercise.restTime : 0;
            updateTimerDisplay();
        }

        function switchMode() {
            stopTimer();
            if (timerMode === 'workout') {
                timerMode = 'rest';
                timerTime = currentExercise.restTime;
            } else {
                timerMode = 'workout';
                timerTime = 0;
            }
            updateTimerDisplay();
            updateControlButtons();
        }

        function updateControlButtons() {
            // Botão Play/Pause
            const lblToggle = document.getElementById('lbl-toggle');
            const btnToggleIcon = btnToggle.querySelector('svg'); // Lucide svg
            
            if (timerActive) {
                lblToggle.innerText = "Pausar";
                btnToggle.classList.replace('bg-emerald-500', 'bg-red-500');
                btnToggle.classList.replace('hover:bg-emerald-600', 'hover:bg-red-600');
                // Icon change logic simpler: just re-render lucide if needed or text is enough
            } else {
                lblToggle.innerText = timerMode === 'rest' ? "Iniciar Descanso" : "Iniciar";
                btnToggle.classList.replace('bg-red-500', 'bg-emerald-500');
                btnToggle.classList.replace('hover:bg-red-600', 'hover:bg-emerald-600');
            }

            // Botão Switch Mode
            if (timerMode === 'workout') {
                btnSwitch.innerHTML = `<i data-lucide="timer"></i> Ir para Descanso (${currentExercise?.restTime}s)`;
                btnSwitch.className = "w-full py-3 bg-amber-600 hover:bg-amber-700 rounded-lg font-bold text-white flex items-center justify-center gap-2 transition-colors";
            } else {
                btnSwitch.innerHTML = `<i data-lucide="dumbbell"></i> Voltar para Execução`;
                btnSwitch.className = "w-full py-3 bg-slate-700 hover:bg-slate-600 rounded-lg font-bold text-white flex items-center justify-center gap-2 transition-colors";
            }
            lucide.createIcons();
        }

        // --- EVENT LISTENERS ---
        btnToggle.addEventListener('click', toggleTimer);
        btnReset.addEventListener('click', resetTimer);
        btnSwitch.addEventListener('click', switchMode);
        btnClose.addEventListener('click', closeModal);
        
        btnMute.addEventListener('click', () => {
            isMuted = !isMuted;
            // Atualiza ícone
            if(isMuted) {
                btnMute.innerHTML = `<i data-lucide="volume-x"></i>`;
                window.speechSynthesis.cancel();
            } else {
                btnMute.innerHTML = `<i data-lucide="volume-2"></i>`;
            }
            lucide.createIcons();
        });

        // Inicializa o app
        init();

    </script>
</body>
</html>
